<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>VS Code - Natural Language Edition</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: #1e1e1e; color: #cccccc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        /* Layout Grid */
        .layout { display: flex; height: 100vh; flex-direction: column; }

        /* Top Bar */
        .menubar { height: 30px; background-color: #333333; display: flex; align-items: center; padding: 0 10px; font-size: 13px; }
        .menubar span { margin-right: 15px; cursor: pointer; }
        .play-btn { color: #89d185; margin-left: auto; cursor: pointer; font-weight: bold; display: flex; align-items: center;}
        .play-btn:hover { color: #adf7a9; }

        /* Main Content */
        .workspace { display: flex; flex: 1; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 250px; background-color: #252526; border-right: 1px solid #000; display: flex; flex-direction: column; }
        .sidebar-header { padding: 10px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .file-item { padding: 5px 20px; cursor: pointer; background-color: #37373d; color: #fff; border-left: 2px solid #007acc; }

        /* Editor Area */
        .editor-container { flex: 1; position: relative; }
        #monaco-editor { width: 100%; height: 100%; }

        /* Terminal Area */
        .terminal { height: 200px; background-color: #1e1e1e; border-top: 1px solid #333; display: flex; flex-direction: column; }
        .terminal-header { padding: 5px 20px; font-size: 11px; text-transform: uppercase; border-bottom: 1px solid #333; display: flex; gap: 20px;}
        .terminal-tab { cursor: pointer; border-bottom: 1px solid transparent; }
        .terminal-tab.active { color: #fff; border-bottom: 1px solid #e7e7e7; }
        .terminal-content { flex: 1; padding: 10px; font-family: 'Consolas', 'Courier New', monospace; font-size: 14px; overflow-y: auto; white-space: pre-wrap; color: #e7e7e7; }

        /* Loader */
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #007acc; border-radius: 50%; width: 12px; height: 12px; animation: spin 1s linear infinite; margin-right: 5px; display: none;}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="layout">
    <div class="menubar">
        <span>File</span>
        <span>Edit</span>
        <span>Selection</span>
        <span>View</span>
        <span>Go</span>
        <div class="play-btn" onclick="runProgram()">
            <div class="spinner" id="spinner"></div>
            &#9658; Esegui (F5)
        </div>
    </div>

    <div class="workspace">
        <div class="sidebar">
            <div class="sidebar-header">Esplora Risorse</div>
            <div class="file-item"> &#128196; programma.ita</div>
        </div>
        <div class="editor-container">
            <div id="monaco-editor"></div>
        </div>
    </div>

    <div class="terminal">
        <div class="terminal-header">
            <span class="terminal-tab">PROBLEMI</span>
            <span class="terminal-tab active">OUTPUT</span>
            <span class="terminal-tab">TERMINALE</span>
        </div>
        <div class="terminal-content" id="output-console">
Benvenuto in VS Code (Natural Language Edition).
Premi "Esegui" per compilare lo pseudocodice.
        </div>
    </div>
</div>

<!-- Carica Monaco Editor da CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.js"></script>
<script>
    let editor;

    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create(document.getElementById('monaco-editor'), {
            value: [
                'funzione somma, che prende in input due variabili x e y:',
                '    restituisce x+y;',
                '',
                'funzione principale Main:',
                '    numero a;',
                '    numero b;',
                '',
                '    a è 35;',
                '    b è 32;',
                '',
                '    chiama la funzione somma, con variabili a e b in input.',
                '    salva il risultato della funzione somma nella variabile c;',
                '',
                '    stampa "Il risultato è: ";',
                '    stampa c;'
            ].join('\n'),
            language: 'python', // Usiamo l'highlighting di Python anche se è pseudo
            theme: 'vs-dark',
            automaticLayout: true,
            fontSize: 14,
            minimap: { enabled: true }
        });
    });

    async function runProgram() {
        const code = editor.getValue();
        const outputDiv = document.getElementById('output-console');
        const spinner = document.getElementById('spinner');

        outputDiv.innerHTML = "<span style='color: #dba936'>Compilazione e avvio in corso...</span>";
        spinner.style.display = 'block';

        try {
            const response = await fetch('/run', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: code })
            });

            const data = await response.json();

            spinner.style.display = 'none';
            outputDiv.innerText = ""; // Pulisci

            // Mostra output
            if(data.output) {
                outputDiv.innerText = data.output;
            } else {
                outputDiv.innerText = "Programma eseguito senza output.";
            }

            // Log del codice python reale in console browser per curiosità
            console.log("--- CODICE COMPILATO (Python) ---");
            console.log(data.compiled_code);

        } catch (error) {
            spinner.style.display = 'none';
            outputDiv.innerHTML = "<span style='color: #f48771'>Errore di comunicazione con il server.</span>";
            console.error(error);
        }
    }

    // Shortcut CTRL+Enter o F5 per eseguire
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey && e.key === 'Enter') || e.key === 'F5') {
            e.preventDefault();
            runProgram();
        }
    });
</script>

</body>
</html>